<!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css"><meta name="keywords" content="CI,Hexo,持续集成,gulp,博客优化,压缩,blog"><link rel="alternate" href="/atom.xml" title="Karl's Notes" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.0"><meta name="description" content="通常更新一篇Hexo博客，基本流程是：

本地新建post页面
hexo n travis-ci-deploy-blog
INFO  Created: e:\WORK\GitHub\think-diff.me.source\source\_posts\travis-ci-deploy-blog.md

在文本编辑器里用markdown语法编辑新建页面
本地生成public文件：hexo g
启动"><meta property="og:type" content="article"><meta property="og:title" content="用Travis CI自动部署Hexo博客"><meta property="og:url" content="https://www.karlzhou.com/2016/05/28/travis-ci-deploy-blog/index.html"><meta property="og:site_name" content="Karl's Notes"><meta property="og:description" content="通常更新一篇Hexo博客，基本流程是：

本地新建post页面
hexo n travis-ci-deploy-blog
INFO  Created: e:\WORK\GitHub\think-diff.me.source\source\_posts\travis-ci-deploy-blog.md

在文本编辑器里用markdown语法编辑新建页面
本地生成public文件：hexo g
启动"><meta property="og:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/build-flow.png"><meta property="og:image" content="https://www.karlzhou.com/images/common/travis.png"><meta property="og:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/passing.svg"><meta property="og:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/travis-encrypt-keys.png"><meta property="og:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/access-token.png"><meta property="og:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/build-success.png"><meta property="og:updated_time" content="2017-01-25T03:50:18.020Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="用Travis CI自动部署Hexo博客"><meta name="twitter:description" content="通常更新一篇Hexo博客，基本流程是：

本地新建post页面
hexo n travis-ci-deploy-blog
INFO  Created: e:\WORK\GitHub\think-diff.me.source\source\_posts\travis-ci-deploy-blog.md

在文本编辑器里用markdown语法编辑新建页面
本地生成public文件：hexo g
启动"><meta name="twitter:image" content="https://www.karlzhou.com/images/travis-ci-deploy-blog/build-flow.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post"},fancybox:!0,motion:!0,duoshuo:{userId:"6284895680469140000",author:"Root"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://www.karlzhou.com/2016/05/28/travis-ci-deploy-blog/"><title> 用Travis CI自动部署Hexo博客 | Karl's Notes</title></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-56188311-1","auto"),ga("send","pageview")</script><script type="text/javascript">var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0ea6102e5274c5a948b3004a38a9b37a";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div class="container one-collumn sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Karl's Notes</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="menu-item-icon fa fa-fw fa-comments"></i><br> 留言</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br> 搜索</a></li></ul><div class="site-search"><div class="popup"><span class="search-icon fa fa-search"></span> <input type="text" id="local-search-input"><div id="local-search-result"></div> <span class="popup-btn-close">close</span></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://www.karlzhou.com/2016/05/28/travis-ci-deploy-blog/"><span style="display:none" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="Karl"><meta itemprop="description" content=""><meta itemprop="image" content="/images/avatar.jpg"></span><span style="display:none" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Karl's Notes"> <span style="display:none" itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject"><img style="display:none" itemprop="url image" alt="Karl's Notes" src=""></span></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 用Travis CI自动部署Hexo博客</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-05-28T15:34:49+00:00">2016-05-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Blog/" itemprop="url" rel="index"><span itemprop="name">Blog</span></a></span></span> <span class="post-comments-count"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i></span><a href="/2016/05/28/travis-ci-deploy-blog/#comments" itemprop="discussionUrl"><span class="post-comments-count ds-thread-count" data-thread-key="2016/05/28/travis-ci-deploy-blog/" itemprop="commentCount"></span></a></span> <span id="/2016/05/28/travis-ci-deploy-blog/" class="leancloud_visitors" data-flag-title="用Travis CI自动部署Hexo博客"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">热度</span><span>&nbsp;</span><span class="leancloud-visitors-count"></span> °C</span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/images/travis-ci-deploy-blog/build-flow.png" alt="Travis Build Flow"></p><p>通常更新一篇Hexo博客，基本流程是：</p><ol><li><p>本地新建post页面</p><pre><code>hexo n travis-ci-deploy-blog
INFO  Created: e:\WORK\GitHub\think-diff.me.source\source\_posts\travis-ci-deploy-blog.md
</code></pre></li><li>在文本编辑器里用markdown语法编辑新建页面</li><li>本地生成public文件：<code>hexo g</code></li><li>启动本地测试web server：<code>hexo s -p 4000 --debug</code></li><li>浏览器打开<code>http://localhost:4000/</code>, 浏览生成文章</li><li>如果满意，即可部署到Github存放page仓库里： <code>hexo d</code></li></ol><a id="more"></a><p>本文主要介绍如何利用TravisCI自动完成第3-6步，同时利用gulp脚本进行html/css/js/images的压缩。</p><h1 id="What-is-Travis-CI"><a href="#What-is-Travis-CI" class="headerlink" title="What is Travis CI?"></a>What is Travis CI?</h1><blockquote class="blockquote-center"><p><img src="/images/common/travis.png" alt="Travis CI"></p></blockquote><p>CI(Continuous Integration)翻译为持续集成。Travis CI是一个提供持续集成功能的平台，在Github上，可以添加Travis CI，当有code push时候，会推送通知到Travis，根据设置的脚本运行指定任务。</p><p>目前有两个站点:</p><p>1.<a href="https://travis-ci.org/" rel="external nofollow noopener noreferrer" target="_blank">Travis.org</a> 对于所有public项目完全免费</p><p>2.<a href="https://travis-ci.com/" rel="external nofollow noopener noreferrer" target="_blank">Travics.com</a> 只针对private项目，提供更多一些额外功能，如cache，并行build个数</p><p>两个站点只能看到各自的项目，不能通用。</p><h1 id="Why-we-need-Travis-CI"><a href="#Why-we-need-Travis-CI" class="headerlink" title="Why we need Travis CI?"></a>Why we need Travis CI?</h1><p>有人可能会有疑问: 在本地写完博客，直接一个命令<code>hexo d</code>，不就搞定了么， 为啥要费力搞CI？</p><p>的确, 想用TravisCI来自动部署Hexo博客程序，需要不少设置（瞎折腾），为了给大伙信心，列举一些优点：</p><h2 id="优点1：直接在线编辑文件，立即生效"><a href="#优点1：直接在线编辑文件，立即生效" class="headerlink" title="优点1：直接在线编辑文件，立即生效"></a>优点1：直接在线编辑文件，立即生效</h2><p>假设你已经发表了一篇文章，过了几天你在朋友机器上浏览发现有几个明显的错别字，对于有强迫症的，这是不能容忍的。 但你手头又没有完整的hexo+nodejs+git的开发环境，重新下载git，node，hexo配置会花费不少时间，特别不划算。</p><p>如果按照这篇完整折腾完，你可以直接用浏览器访问github个人项目仓库，直接编辑那篇post的原md文件，前后2分钟改完。 稍等片刻，你的博客就自动更新了。</p><h2 id="优点2：自动部署，同时部署到多个地方"><a href="#优点2：自动部署，同时部署到多个地方" class="headerlink" title="优点2：自动部署，同时部署到多个地方"></a>优点2：自动部署，同时部署到多个地方</h2><p>在gitcafe是被收购之前，很多同学（包括我）都是托管在上面的，国内访问速度比Github快很多。<br>配合DNS根据IP位置可以自动选择导到gitcafe, 还是github，甚至你还可以部署到七牛云的静态网站。<br>利用Travis CI可同时更新多个仓库。</p><h2 id="优点3：部署快捷方便"><a href="#优点3：部署快捷方便" class="headerlink" title="优点3：部署快捷方便"></a>优点3：部署快捷方便</h2><p>手动deploy需要推送public整个folder到github上，当后期网站文章、图片较多时候，对于天朝的网络，有时候连接github 就是不顺畅，经常要傻等不少上传时间。<br>有了CI，你可以只提交post文件里单独的md文件即可，很快很爽，谁用谁知道。</p><h2 id="优点4：bigger-than-bigger"><a href="#优点4：bigger-than-bigger" class="headerlink" title="优点4：bigger than bigger"></a>优点4：bigger than bigger<a id="build-icon"></a></h2><p><img src="/images/travis-ci-deploy-blog/passing.svg" alt="build icon"></p><p>你的项目Readme里面可以显示CI build图标，很酷有没有？<br>另外通过设置，可以在当build失败时自动发邮件提醒你。<br>上面的图标，如果登陆后你在Github项目里，直接点击图标，会跳转到你当前项目build的log界面，很方便。</p><p>当然有了CI，你可以做很多事情，如自动运行单元测试，成功后再deploy等等。很多项目里的持续集成基本也是这个道理。</p><h1 id="How-to-use-Travis-CI-to-deploy-hexo-blog"><a href="#How-to-use-Travis-CI-to-deploy-hexo-blog" class="headerlink" title="How to use Travis CI to deploy hexo blog?"></a>How to use Travis CI to deploy hexo blog?</h1><p>这篇教程是用的private项目演示的，多年前领取了Github的Education plan，给了我五个private项目。不管public或者private，步骤都是通用的。<br>我的博客项目设置的Travis脚本<code>.travis.yml</code>会做如下事情：</p><ol><li>从github clone整个项目</li><li>在本地安装nodejs，hexo以及相关node modules</li><li>运行gulp脚本 build文章，包括压缩css、html、js、image</li><li>进入到public folder，初始化一个git仓库，然后推送到github page<br>我用的是user page，也可以是gh-pages，具体区别可参考<a href="https://help.github.com/articles/user-organization-and-project-pages/" rel="external nofollow noopener noreferrer" target="_blank">这里</a></li></ol><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>对于public项目，Travis CI可以自由clone，也就是说有read权限，但是没有write权限，如果什么都不设置，是push不了code的。<br>所以最关键的一步是找到一个安全的方法，让TravisCI拿着Github的token去push code。</p><p><img src="/images/travis-ci-deploy-blog/travis-encrypt-keys.png" alt="Travis加密图解"></p><p>用非对称加密key，简单说就是用<a href="https://docs.travis-ci.com/user/encryption-keys/" rel="external nofollow noopener noreferrer" target="_blank">Travis public key加密</a>，然后Travis用自己的private key去解密，然后使用。<br>至于加密的内容，你可以加密多种东西，以<a href="https://docs.travis-ci.com/user/environment-variables/" rel="external nofollow noopener noreferrer" target="_blank">Travis环境变量</a>的格式引用，下文详述。</p><p>参考了如下几篇文章：</p><p>1.<a href="https://zespia.tw/blog/2015/01/21/continuous-deployment-to-github-with-travis/" rel="external nofollow noopener noreferrer" target="_blank">用 Travis CI 自動部署網站到 GitHub</a> 作者是hexo的发明者<a href="https://github.com/tommy351" rel="external nofollow noopener noreferrer" target="_blank">@tommy351</a>，他的做法是用travis client加密ssh key，然后travis解密拿到key去操作仓库代码。缺点：因为是给的访问github个人账户的ssh私钥，所以权限是full的，可以操作任何部分。</p><p>2.<a href="http://changyuheng.me/2015/when-hexo-static-site-meets-github-pages-and-travis-ci/" rel="external nofollow noopener noreferrer" target="_blank">When Hexo Meets GitHub Pages and Travis CI plus Raspberry Pi</a> 这篇文章讲了一个tricky的方法，github每个仓库可以单独设置访问ssh public key，然后把private key放在Travis的环境变量里面，但是因为key中间有特殊字符，不能直接使用，所以经过base64编码存放在Travis环境变量。然后再travis.yml设置base64 -d解码出来这个环境变量</p><p>3.<a href="http://notes.iissnan.com/2016/publishing-github-pages-with-travis-ci/#comments" rel="external nofollow noopener noreferrer" target="_blank">使用 Travis CI 自动更新 GitHub Pages</a> 这也是本文主要参考的一篇文章，上面图也是借用的这里的。原理：github提供了access token的方法来访问仓库，其实是OAuth2里面的token，每个token可以设置不同的<a href="https://developer.github.com/v3/oauth/#scopes" rel="external nofollow noopener noreferrer" target="_blank">访问scope</a>来控制访问范围。然后加密这个token存放到Travis环境变量里面，后面步骤类似。</p><h2 id="Step-by-Step"><a href="#Step-by-Step" class="headerlink" title="Step by Step"></a>Step by Step</h2><ol><li>准备Travis CI账号, 传送门：<a href="https://travis-ci.org/" rel="external nofollow noopener noreferrer" target="_blank">public项目</a>, <a href="https://travis-ci.com/" rel="external nofollow noopener noreferrer" target="_blank">private项目</a>, 在登陆成功后，可以看到自己的Github项目，然后把开关打开，会自动hook到Github。</li><li>准备Github Personal Access Token。在Github的<a href="https://github.com/settings/profile" rel="external nofollow noopener noreferrer" target="_blank">setting页面</a>，左侧面板选择<a href="https://github.com/settings/tokens" rel="external nofollow noopener noreferrer" target="_blank">Personal access tokens</a>, 右上角点击<code>Generate new token</code>。生成token时候需要确定访问scope，这里我们选择第一个<code>repo</code>即可，参见<a href="https://developer.github.com/v3/oauth/#scopes" rel="external nofollow noopener noreferrer" target="_blank">完整scope介绍</a>。<strong>重要</strong>：生成的token只有第一次可见，一定要保存下来备用。<br><img src="/images/travis-ci-deploy-blog/access-token.png" alt="access token"></li><li><p>准备<a href="https://github.com/travis-ci/travis.rb" rel="external nofollow noopener noreferrer" target="_blank">Travis命令行工具</a>，需要依赖ruby环境。对于Windows环境，可以使用这里的<a href="http://rubyinstaller.org/downloads/" rel="external nofollow noopener noreferrer" target="_blank">安装包</a>，安装完成后可用<code>ruby -v</code>检查。<br>安装命令行工具，参考<a href="https://github.com/travis-ci/travis.rb#installation" rel="external nofollow noopener noreferrer" target="_blank">这里官方文档</a>：</p><pre><code>$ gem install travis -v 1.8.2 --no-rdoc --no-ri

Now make sure everything is working:
$ travis version
1.8.2
</code></pre></li><li><p>加密第2步生成的token，<strong>用Github的</strong>用户名/密码登录这个命令行工具。</p><pre><code>$ travis login
We need your GitHub login to identify you.
This information will not be sent to Travis CI, only to GitHub.
The password will not be displayed.

Try running with --github-token or --auto if you don&apos;t want to enter your password anyway.

Username: rkh
Password: *******************

Successfully logged in!
</code></pre><p>登陆成功后，开始加密，参考<a href="https://github.com/travis-ci/travis.rb#encrypt" rel="external nofollow noopener noreferrer" target="_blank">这里</a>：</p><pre><code>travis encrypt -r &lt;github name&gt;/&lt;github repo&gt; GH_Token=XXX

#sample：
travis encrypt -r zhoujiealex/think-diff.me.source GH_TOKEN=8440d51db2c46xxx
</code></pre><p>把输出的<code>secure:&quot;xxxx&quot;</code>保存，其中<code>GH_Token</code>是设置的Travis的环境变量名字，git push时候会用到。</p></li><li><p>配置<code>.travis.yml</code>（如果没有，新建），参考<a href="https://docs.travis-ci.com/user/languages/javascript-with-nodejs" rel="external nofollow noopener noreferrer" target="_blank">javascript的guide</a>。最关键的是其中<code>env</code>的部分:</p><pre><code>env:
 global:
   - GIT_PAGE_REF: github.com/zhoujiealex/zhoujiealex.github.io.git
   - secure: &quot;&lt;第4步生成的加密key&gt;&quot;
</code></pre><p>这里需要<strong>注意</strong>的是：仓库地址，这个地址其实就是你github上存放静态博客最终文件的仓库地址，末尾加上<code>.git</code>。</p></li><li><p>让Travis CI自动向上面设置的仓库地址提交code。这里我用了gulp脚本，来自动调用<code>hexo generate</code>，然后进行压缩，最后deploy。</p></li><li><p><a href="https://docs.travis-ci.com/user/status-images/" rel="external nofollow noopener noreferrer" target="_blank">集成build icon</a>，在Travis CI控制台里，点击那个icon，选择markdown的样式，然后放到项目Readme里即可。</p></li></ol><h1 id="完整配置文件"><a href="#完整配置文件" class="headerlink" title="完整配置文件"></a>完整配置文件</h1><p>完整<code>.travis.yml</code>，参考<a href="https://gist.github.com/zhoujiealex/787870ec64e774a1ac3d5e17e7e0b23c" rel="external nofollow noopener noreferrer" target="_blank">这个gist</a>(翻不了墙的<a href="/files/travis-ci-deploy-blog/travis_yml.txt">看这里</a>)，里面设置了邮件通知，启用node module cache等。主要是环境变量<code>GH_Token</code> 和 <code>GIT_PAGE_REF</code> 使用方式。</p><p>完整<code>gulpfile.js</code>，参考<a href="https://gist.github.com/zhoujiealex/4d926889b02b85d4d8d73f036ef728eb" rel="external nofollow noopener noreferrer" target="_blank">这个gist</a>(翻不了墙的<a href="/files/travis-ci-deploy-blog/gulpfile_js.txt">看这里</a>)。<br>唯一的魔法，就是其中调用Hexo API去generate public文件的部分，参考<a href="https://hexo.io/api/" rel="external nofollow noopener noreferrer" target="_blank">Hexo API</a>, 语法是hexo使用的<a href="https://github.com/petkaantonov/bluebird" rel="external nofollow noopener noreferrer" target="_blank">bluebird</a>的Promise写法，感兴趣具体可自行谷歌。</p><p>我使用的<a href="https://gist.github.com/zhoujiealex/3259ca61efdb12bbdf83aea99d9ff705" rel="external nofollow noopener noreferrer" target="_blank">package.json</a>(翻不了墙的<a href="/files/travis-ci-deploy-blog/package_json.txt">看这里</a>)，如果想使用我的<code>gulpfile.js</code>需要用<code>npm install</code>安装里面的module。</p><p>配置完成后，以后当你本地编辑完md文件后，只需要运行<code>git push orgin master</code>，推送代码到Github就会触发自动Travis CI 自动生成build，部署新的文章。</p><p>最后上一张，点击上面<a href="#build-icon">build那个icon</a>时候，看到的后台Travis CI的build log，如果出错就需要查看这里。</p><p><img src="/images/travis-ci-deploy-blog/build-success.png" alt="travis ci build log"></p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>其实我很早就搞了这个域名，一直没有维护，当时2014年第一次看别人介绍Hexo部署个人博客，感觉很酷，就折腾了下， 托管在GitCafe上。前段时间，一直收到DNSPOD的报警，说网站访问不了了，过了好几天还没恢复，以往都是10分钟以内就能 恢复的。抽空看了下，才知道<a href="http://www.zhihu.com/question/40942874" rel="external nofollow noopener noreferrer" target="_blank">GitCafe被Coding收购</a>了。 没办法我就把站点搬回Github了，又瞎折腾了一堆主题和插件。</p><p>真的很佩服那些持续写博客记录，分享的人，自己也从中学到了很多知识。坚持写作不容易，费时费力。</p><p>最后希望这篇文章能帮助一些小伙伴少走些弯路。</p></div><div></div><div></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Hexo/" rel="tag"># Hexo</a> <a href="/tags/gulp/" rel="tag"># gulp</a> <a href="/tags/Node-js/" rel="tag"># Node.js</a> <a href="/tags/持续集成/" rel="tag"># 持续集成</a></div><div class="copyright"> <strong>本文链接:</strong> https://www.karlzhou.com/2016/05/28/travis-ci-deploy-blog/<br> <strong>版权声明:</strong> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/cn/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0 CN</a> 许可协议。转载请注明出处！<br></div><div class="post-nav"><div class="post-nav-next post-nav-item"><h4>PREVIOUS POST</h4><a href="/2014/10/27/set-blog-with-hexo/" rel="next" title="用Hexo搭建博客（一）:如何搭建？"><i class="fa fa-chevron-left"></i> 用Hexo搭建博客（一）:如何搭建？</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><h4>NEXT POST</h4> <a href="/articles/center-log-with-rsyslog/" rel="prev" title="日志集中化收集（一）：rsyslog 配置">日志集中化收集（一）：rsyslog 配置<i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"><div class="ds-thread" data-thread-key="2016/05/28/travis-ci-deploy-blog/" data-title="用Travis CI自动部署Hexo博客" data-url="https://www.karlzhou.com/2016/05/28/travis-ci-deploy-blog/"></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Karl"><p class="site-author-name" itemprop="name">Karl</p><p class="site-description motion-element" itemprop="description">If you can think differently, you can act differently. Just do IT!</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">8</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <span class="site-state-item-count">5</span> <span class="site-state-item-name">分类</span></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zhoujiealex/" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-github"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://stackoverflow.com/users/1386591/zjalex/" target="_blank" title="StackOverflow" rel="external nofollow noopener noreferrer"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a></span></div><div class="cc-license motion-element" itemprop="license"> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank" rel="external nofollow noopener noreferrer"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class="links-of-blogroll-title"><i class="fa fa-fw fa-globe"></i> Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"> <a href="http://blog.jobbole.com/" title="伯乐在线" target="_blank" rel="external nofollow noopener noreferrer">伯乐在线</a></li><li class="links-of-blogroll-item"> <a href="http://toutiao.io/" title="开发者头条" target="_blank" rel="external nofollow noopener noreferrer">开发者头条</a></li><li class="links-of-blogroll-item"> <a href="http://www.appinn.com/" title="小众软件" target="_blank" rel="external nofollow noopener noreferrer">小众软件</a></li></ul></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#What-is-Travis-CI"><span class="nav-number">1.</span> <span class="nav-text">What is Travis CI?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Why-we-need-Travis-CI"><span class="nav-number">2.</span> <span class="nav-text">Why we need Travis CI?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#优点1：直接在线编辑文件，立即生效"><span class="nav-number">2.1.</span> <span class="nav-text">优点1：直接在线编辑文件，立即生效</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点2：自动部署，同时部署到多个地方"><span class="nav-number">2.2.</span> <span class="nav-text">优点2：自动部署，同时部署到多个地方</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点3：部署快捷方便"><span class="nav-number">2.3.</span> <span class="nav-text">优点3：部署快捷方便</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优点4：bigger-than-bigger"><span class="nav-number">2.4.</span> <span class="nav-text">优点4：bigger than bigger</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#How-to-use-Travis-CI-to-deploy-hexo-blog"><span class="nav-number">3.</span> <span class="nav-text">How to use Travis CI to deploy hexo blog?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#原理"><span class="nav-number">3.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-by-Step"><span class="nav-number">3.2.</span> <span class="nav-text">Step by Step</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#完整配置文件"><span class="nav-number">4.</span> <span class="nav-text">完整配置文件</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#后记"><span class="nav-number">5.</span> <span class="nav-text">后记</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; 2014 - <span itemprop="copyrightYear">2017</span><span class="with-love"><i class="fa fa-trophy"></i></span> <span class="author" itemprop="copyrightHolder"><a href="mailto:i@karlzhou.com">Karl</a></span> <span class="cc-license" itemprop="license"><a style="border:0;margin:0 5px;position:relative;top:2px;left:8px" href="https://creativecommons.org/licenses/by-nc-sa/4.0/cn/" target="_blank" rel="external nofollow noopener noreferrer"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></span> <span class="beian" style="margin-right:10px"><a href="http://www.miitbeian.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">&nbsp; 苏ICP备16056788号</a></span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/jquery.lazyload/1.9.3/jquery.lazyload.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/velocity/1.2.3/velocity.ui.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script><script type="text/javascript">var duoshuoQuery={short_name:"thinkdiffme"};!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.id="duoshuo-script",e.src="/js/src/duoshuo-embed.js",e.charset="UTF-8",(document.getElementById("footer")||document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script type="text/javascript">function proceedsearch(){$("body").append('<div class="popoverlay">').css("overflow","hidden"),$(".popup").toggle()}var isfetched=!1,search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path,searchFunc=function(e,t,a){"use strict";$.ajax({url:e,dataType:"xml",async:!0,success:function(e){isfetched=!0,$(".popup").detach().appendTo(".header-inner");var c=$("entry",e).map(function(){return{title:$("title",this).text(),content:$("content",this).text(),url:$("url",this).text()}}).get(),r=document.getElementById(t),n=document.getElementById(a);r.addEventListener("input",function(){var e=0,t='<ul class="search-result-list">',a=this.value.trim().toLowerCase().split(/[\s\-]+/);n.innerHTML="",this.value.trim().length>1&&c.forEach(function(c){var r=!1,n=c.title.trim().toLowerCase(),o=c.content.trim().replace(/<[^>]+>/g,"").toLowerCase(),s=decodeURIComponent(c.url),i=-1,l=-1,p=-1;if(""!=n&&a.forEach(function(e,t){i=n.indexOf(e),l=o.indexOf(e),(i>=0||l>=0)&&(r=!0,0==t&&(p=l))}),r){e+=1,t+="<li><a href='"+s+"' class='search-result-title'>"+n+"</a>";var h=c.content.trim().replace(/<[^>]+>/g,"");if(p>=0){var u=p-20,d=p+80;u<0&&(u=0),0==u&&(d=50),d>h.length&&(d=h.length);var f=h.substring(u,d);a.forEach(function(e){var t=new RegExp(e,"gi");f=f.replace(t,'<b class="search-keyword">'+e+"</b>")}),t+='<p class="search-result">'+f+"...</p>"}t+="</li>"}}),t+="</ul>",0==e&&(t='<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'),""==a&&(t='<div id="no-result"><i class="fa fa-search fa-5x" /></div>'),n.innerHTML=t}),proceedsearch()}})};$(".popup-trigger").click(function(e){e.stopPropagation(),0==isfetched?searchFunc(path,"local-search-input","local-search-result"):proceedsearch()}),$(document).keydown(function(e){27==e.keyCode&&$(".popup-btn-close").click()}),$(".popup-btn-close").click(function(e){$(".popup").hide(),$(".popoverlay").remove(),$("body").css("overflow","")}),$(".popup").click(function(e){e.stopPropagation()})</script><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script><script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script><script type="text/javascript" src=""></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script><script>AV.initialize("Hla639U7xDAWLJLhOqSgLhvy-gzGzoHsz","C8ubwzRtIYV9J5qA0wfjQBct")</script><script>function showTime(e){var t=new AV.Query(e),n=[],o=$(".leancloud_visitors");o.each(function(){n.push($(this).attr("id").trim())}),t.containedIn("url",n),t.find().done(function(e){var t=".leancloud-visitors-count";if(0===e.length)return void o.find(t).text(0);for(var i=0;i<e.length;i++){var r=e[i],s=r.get("url"),l=r.get("time"),c=document.getElementById(s);$(c).find(t).text(l)}for(var i=0;i<n.length;i++){var s=n[i],c=document.getElementById(s),u=$(c).find(t);""==u.text()&&u.text(0)}}).fail(function(e,t){console.log("Error: "+t.code+" "+t.message)})}function addCount(e){var t=$(".leancloud_visitors"),n=t.attr("id").trim(),o=t.attr("data-flag-title").trim(),i=new AV.Query(e);i.equalTo("url",n),i.find({success:function(t){if(t.length>0){var i=t[0];i.fetchWhenSave(!0),i.increment("time"),i.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})}else{var r=new e,s=new AV.ACL;s.setPublicReadAccess(!0),s.setPublicWriteAccess(!0),r.setACL(s),r.set("title",o),r.set("url",n),r.set("time",1),r.save(null,{success:function(e){var t=$(document.getElementById(n));t.find(".leancloud-visitors-count").text(e.get("time"))},error:function(e,t){console.log("Failed to create")}})}},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}$(function(){var e=AV.Object.extend("Counter");1==$(".leancloud_visitors").length?addCount(e):$(".post-title-link").length>1&&showTime(e)})</script><script>!function(){var t=document.createElement("script"),s=window.location.protocol.split(":")[0];"https"===s?t.src="https://zz.bdstatic.com/linksubmit/push.js":t.src="http://push.zhanzhang.baidu.com/push.js";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script></body></html>